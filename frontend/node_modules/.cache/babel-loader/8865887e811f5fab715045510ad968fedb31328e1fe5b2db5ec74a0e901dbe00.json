{"ast":null,"code":"import _regeneratorRuntime from\"C:/Users/Administrator/Desktop/S07P31C209/frontend/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"C:/Users/Administrator/Desktop/S07P31C209/frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"C:/Users/Administrator/Desktop/S07P31C209/frontend/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{useState}from'react';import html2canvas from'html2canvas';import{useNavigate}from'react-router-dom';import{saveAs}from'file-saver';import{returnTrue,returnFalse}from'@common/commonFunc';import Report from'@messageDetail/Report';import Confirm from'@common/Confirm';import Alert from'@common/Alert';import'@common/Common.scss';import{jsx as _jsx}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function MoreMenu(_ref){var open=_ref.open,isMine=_ref.isMine,detail=_ref.detail,messageId=_ref.messageId,type=_ref.type,content=_ref.content,close=_ref.close,status=_ref.status;var navigate=useNavigate();var _useState=useState({title:'',message:''}),_useState2=_slicedToArray(_useState,2),info=_useState2[0],setInfo=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),openConfirm=_useState4[0],setConfirm=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),openReport=_useState6[0],setReport=_useState6[1];var _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),openAlert=_useState8[0],setAlert=_useState8[1];var _useState9=useState(false),_useState10=_slicedToArray(_useState9,2),deleted=_useState10[0],setDeleted=_useState10[1];var _useState11=useState(status),_useState12=_slicedToArray(_useState11,2),newStatus=_useState12[0],setNewStatus=_useState12[1];// info 값 변경\nvar changeInfo=function changeInfo(title,message){setInfo(function(){return{title:title,message:message};});};var saveMessage=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){var height,width,x,resultWidth;return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:close();if(type===0){height=window.innerHeight;width=window.innerWidth;x=0;resultWidth=width;if(width/height>9/16){resultWidth=height*56.25/100;x=(width-resultWidth)/2;}html2canvas(detail.current,{x:x,width:resultWidth,height:height}).then(function(canvas){saveAs(canvas.toDataURL(),\"fairytail_\".concat(messageId,\".png\"));});}else{// content는 url형식\nsaveAs(content,\"fairytail_\".concat(messageId,\".png\"));}case 2:case\"end\":return _context.stop();}}},_callee);}));return function saveMessage(){return _ref2.apply(this,arguments);};}();// 신고 팝업\nvar reportMessage=function reportMessage(){setReport(returnTrue);console.log('신고 페이지로');console.log('back에 요청 - axios');};// 메시지 상태(공개, 비공개) 설정\n// const toEdit = () => {\n//   if (messageId) {\n//     navigate(toMessageUpdate(messageId));\n//     close();\n//   }\n// };\nvar presentStatus=function presentStatus(statusNum){return statusNum===0?'공개':'비공개';};var changeStatus=function changeStatus(){// 백에 변경 요청 보내기\nsetNewStatus(function(prev){return 1-prev;});// 변경되었음을 알림\nchangeInfo('완료',\"\\uC791\\uC131\\uD55C \\uBA54\\uC2DC\\uC9C0\\uAC00\\n\".concat(presentStatus(1-newStatus),\"\\uB85C \\uBCC0\\uACBD\\uB418\\uC5C8\\uC2B5\\uB2C8\\uB2E4.\"));setAlert(returnTrue);};// 삭제 확인\nvar onDelete=function onDelete(){changeInfo('확인','정말 삭제하시겠습니까?');setConfirm(returnTrue);close();};// 취소 버튼\nvar onCancel=function onCancel(){setConfirm(returnFalse);changeInfo('','');close();};// 알림 창\nvar closeAlert=function closeAlert(){setAlert(returnFalse);close();changeInfo('','');};// 신고 취소\nvar onReportCancel=function onReportCancel(){setReport(returnFalse);close();};// 삭제 요청 백에 보내기\nvar deleteMessage=function deleteMessage(){setDeleted(returnTrue);// axios.delete('url')\n// .then(())\nchangeInfo('완료','글이 정상적으로 삭제되었습니다');setAlert(returnTrue);setConfirm(returnFalse);// 동기로 처리\n// changeInfo('', '');\n};return/*#__PURE__*/_jsxs(_Fragment,{children:[open?/*#__PURE__*/_jsxs(\"main\",{id:\"menu\",children:[isMine?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"article\",{className:\"button\",onClick:changeStatus,children:\"\".concat(presentStatus(1-newStatus),\"\\uB85C \\uBCC0\\uACBD\")}),/*#__PURE__*/_jsx(\"article\",{className:\"button\",onClick:onDelete,children:\"\\uC0AD\\uC81C\"})]}):/*#__PURE__*/_jsx(_Fragment,{children:/*#__PURE__*/_jsx(\"article\",{className:\"button\",onClick:reportMessage,children:\"\\uC2E0\\uACE0\"})}),/*#__PURE__*/_jsx(\"article\",{className:\"button\",onClick:saveMessage,children:\"\\uC800\\uC7A5\"})]}):null,/*#__PURE__*/_jsx(Alert,{info:info,open:openAlert,onConfirmed:closeAlert}),/*#__PURE__*/_jsx(Confirm,{info:info,onConfirmed:deleteMessage,onCancel:onCancel,open:openConfirm}),/*#__PURE__*/_jsx(Report,{onCancel:onReportCancel,open:openReport})]});}export default MoreMenu;","map":{"version":3,"names":["useState","html2canvas","useNavigate","saveAs","returnTrue","returnFalse","Report","Confirm","Alert","MoreMenu","open","isMine","detail","messageId","type","content","close","status","navigate","title","message","info","setInfo","openConfirm","setConfirm","openReport","setReport","openAlert","setAlert","deleted","setDeleted","newStatus","setNewStatus","changeInfo","saveMessage","height","window","innerHeight","width","innerWidth","x","resultWidth","current","then","canvas","toDataURL","reportMessage","console","log","presentStatus","statusNum","changeStatus","prev","onDelete","onCancel","closeAlert","onReportCancel","deleteMessage"],"sources":["C:/Users/Administrator/Desktop/S07P31C209/frontend/src/components/common/MoreMenu.tsx"],"sourcesContent":["import {useState} from 'react';\r\nimport html2canvas from 'html2canvas';\r\nimport {useNavigate} from 'react-router-dom';\r\nimport {saveAs} from 'file-saver';\r\nimport {returnTrue, returnFalse} from '@common/commonFunc';\r\nimport Report from '@messageDetail/Report';\r\nimport Confirm from '@common/Confirm';\r\nimport Alert from '@common/Alert';\r\nimport {popUp} from '@common/commonFunc';\r\nimport {toMessageUpdate} from '@/apis/router';\r\nimport '@common/Common.scss';\r\n\r\ninterface MoreMenuProps {\r\n  open: boolean;\r\n  isMine: boolean;\r\n  detail: any;\r\n  messageId: string | undefined;\r\n  type: number;\r\n  content: string;\r\n  close: () => void;\r\n  status: number;\r\n}\r\n\r\nfunction MoreMenu({\r\n  open,\r\n  isMine,\r\n  detail,\r\n  messageId,\r\n  type,\r\n  content,\r\n  close,\r\n  status,\r\n}: MoreMenuProps) {\r\n  const navigate = useNavigate();\r\n  const [info, setInfo] = useState({title: '', message: ''});\r\n  const [openConfirm, setConfirm] = useState(false);\r\n  const [openReport, setReport] = useState(false);\r\n  const [openAlert, setAlert] = useState(false);\r\n  const [deleted, setDeleted] = useState(false);\r\n  const [newStatus, setNewStatus] = useState(status);\r\n\r\n  // info 값 변경\r\n  const changeInfo = (title: popUp['title'], message: popUp['message']) => {\r\n    setInfo(() => ({\r\n      title,\r\n      message,\r\n    }));\r\n  };\r\n\r\n  const saveMessage = async () => {\r\n    close();\r\n    if (type === 0) {\r\n      const height = window.innerHeight;\r\n      const width = window.innerWidth;\r\n\r\n      let x = 0;\r\n      let resultWidth = width;\r\n\r\n      if (width / height > 9 / 16) {\r\n        resultWidth = (height * 56.25) / 100;\r\n        x = (width - resultWidth) / 2;\r\n      }\r\n\r\n      html2canvas(detail.current, {\r\n        x: x,\r\n        width: resultWidth,\r\n        height: height,\r\n      }).then(canvas => {\r\n        saveAs(canvas.toDataURL(), `fairytail_${messageId}.png`);\r\n      });\r\n    } else {\r\n      // content는 url형식\r\n      saveAs(content, `fairytail_${messageId}.png`);\r\n    }\r\n  };\r\n  // 신고 팝업\r\n  const reportMessage = () => {\r\n    setReport(returnTrue);\r\n    console.log('신고 페이지로');\r\n    console.log('back에 요청 - axios');\r\n  };\r\n  // 메시지 상태(공개, 비공개) 설정\r\n  // const toEdit = () => {\r\n  //   if (messageId) {\r\n  //     navigate(toMessageUpdate(messageId));\r\n  //     close();\r\n  //   }\r\n  // };\r\n  const presentStatus = (statusNum: number) =>\r\n    statusNum === 0 ? '공개' : '비공개';\r\n  const changeStatus = () => {\r\n    // 백에 변경 요청 보내기\r\n    setNewStatus(prev => 1 - prev);\r\n    // 변경되었음을 알림\r\n    changeInfo(\r\n      '완료',\r\n      `작성한 메시지가\\n${presentStatus(1 - newStatus)}로 변경되었습니다.`,\r\n    );\r\n    setAlert(returnTrue);\r\n  };\r\n  // 삭제 확인\r\n  const onDelete = () => {\r\n    changeInfo('확인', '정말 삭제하시겠습니까?');\r\n    setConfirm(returnTrue);\r\n    close();\r\n  };\r\n  // 취소 버튼\r\n  const onCancel = () => {\r\n    setConfirm(returnFalse);\r\n    changeInfo('', '');\r\n    close();\r\n  };\r\n  // 알림 창\r\n  const closeAlert = () => {\r\n    setAlert(returnFalse);\r\n    close();\r\n    changeInfo('', '');\r\n  };\r\n  // 신고 취소\r\n  const onReportCancel = () => {\r\n    setReport(returnFalse);\r\n    close();\r\n  };\r\n\r\n  // 삭제 요청 백에 보내기\r\n  const deleteMessage = () => {\r\n    setDeleted(returnTrue);\r\n    // axios.delete('url')\r\n    // .then(())\r\n    changeInfo('완료', '글이 정상적으로 삭제되었습니다');\r\n    setAlert(returnTrue);\r\n    setConfirm(returnFalse);\r\n    // 동기로 처리\r\n    // changeInfo('', '');\r\n  };\r\n\r\n  return (\r\n    <>\r\n      {open ? (\r\n        <main id=\"menu\">\r\n          {isMine ? (\r\n            <>\r\n              <article className=\"button\" onClick={changeStatus}>\r\n                {`${presentStatus(1 - newStatus)}로 변경`}\r\n              </article>\r\n              <article className=\"button\" onClick={onDelete}>\r\n                삭제\r\n              </article>\r\n            </>\r\n          ) : (\r\n            <>\r\n              <article className=\"button\" onClick={reportMessage}>\r\n                신고\r\n              </article>\r\n            </>\r\n          )}\r\n          <article className=\"button\" onClick={saveMessage}>\r\n            저장\r\n          </article>\r\n        </main>\r\n      ) : null}\r\n\r\n      {/* 공개 여부 변경 모달 */}\r\n      <Alert info={info} open={openAlert} onConfirmed={closeAlert} />\r\n\r\n      {/* 삭제 확인 모달 */}\r\n      <Confirm\r\n        info={info}\r\n        onConfirmed={deleteMessage}\r\n        onCancel={onCancel}\r\n        open={openConfirm}\r\n      />\r\n\r\n      {/* 신고 모달 */}\r\n      <Report onCancel={onReportCancel} open={openReport} />\r\n    </>\r\n  );\r\n}\r\n\r\nexport default MoreMenu;\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}