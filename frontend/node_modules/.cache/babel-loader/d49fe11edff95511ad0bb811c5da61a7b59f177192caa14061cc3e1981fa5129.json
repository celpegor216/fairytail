{"ast":null,"code":"import _regeneratorRuntime from\"C:/Users/Administrator/Desktop/S07P31C209/frontend/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"C:/Users/Administrator/Desktop/S07P31C209/frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"C:/Users/Administrator/Desktop/S07P31C209/frontend/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import'./VR.scss';import Iframe from'react-iframe';import{useNavigate,useLocation}from'react-router-dom';import{useEffect,useState}from'react';import Loading from'@/components/loading/Loading';import MoveToBack from'@/components/common/MoveToBack';import{useRecoilState}from'recoil';import{getMessageVR}from'@/apis/vr';import OptionBtn from'@/components/vr/OptionBtn';import{loadingState}from'@apis/Recoil';import InitMessage from'@/apis/notifications/foregroundMessaging';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";function VR(){// recoil\nvar _useRecoilState=useRecoilState(loadingState),_useRecoilState2=_slicedToArray(_useRecoilState,2),isLoading=_useRecoilState2[0],setIsLoading=_useRecoilState2[1];var navigate=useNavigate();// 정렬 옵션: false-최신순, true-좋아요순\nvar _useState=useState(false),_useState2=_slicedToArray(_useState,2),option=_useState2[0],setOption=_useState2[1];var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),data=_useState4[0],setData=_useState4[1];var _useState5=useState(-1),_useState6=_slicedToArray(_useState5,2),isFinished=_useState6[0],setIsFinished=_useState6[1];// 이전 페이지에서 받은 위치 정보를 location에 저장\nvar state=useLocation().state;var position=state?state.position:null;var _useState7=useState(position),_useState8=_slicedToArray(_useState7,2),location=_useState8[0],setLocation=_useState8[1];// iframe 준비 확인\nvar _useState9=useState(false),_useState10=_slicedToArray(_useState9,2),isLoaded=_useState10[0],setIsLoaded=_useState10[1];useEffect(function(){// 받은 위치 정보가 없을 경우, 현재 위치 받아오기\nif(location===null){if(navigator.geolocation){navigator.geolocation.getCurrentPosition(/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(pos){return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:setLocation({lat:pos.coords.latitude,lng:pos.coords.longitude});case 1:case\"end\":return _context.stop();}}},_callee);}));return function(_x){return _ref.apply(this,arguments);};}());}else{alert('브라우저에서 위치 정보를 얻을 수 없습니다.');navigate(-1);}}else{// 서버에서 데이터 받아오기\nvar optionString=option?'like':'latest';for(var i=0;i<4;i++){getMessageVR(i,optionString,location).then(function(res){setData(function(prev){return prev.concat(res.data);});setIsFinished(function(prev){return prev+1;});}).catch(function(err){console.log(err);});}}},[isLoaded,option]);// 자식에 데이터 전달\nuseEffect(function(){if(isFinished===3&&data.length>0){var _child$0$contentWindo;console.log(option);var child=document.getElementsByTagName('iframe');(_child$0$contentWindo=child[0].contentWindow)===null||_child$0$contentWindo===void 0?void 0:_child$0$contentWindo.postMessage(data,'*');setIsFinished(-1);}},[isFinished,data]);// 자식에게서 메세지 받을 경우 페이지 이동\nvar _useState11=useState(0),_useState12=_slicedToArray(_useState11,2),postId=_useState12[0],setPostId=_useState12[1];var receiveMsgFromChild=function receiveMsgFromChild(ev){if(ev.data==='denied'){navigate(-1);}else if(ev.data==='create'){navigate('/message/create');}else if(typeof ev.data==='number'){setPostId(ev.data);navigate(\"/message/detail/\".concat(ev.data));}};useEffect(function(){window.addEventListener('message',receiveMsgFromChild);return function(){return window.removeEventListener('message',receiveMsgFromChild);};},[postId]);return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(InitMessage,{}),/*#__PURE__*/_jsxs(\"div\",{className:\"vr\",children:[isLoaded?null:/*#__PURE__*/_jsx(Loading,{}),/*#__PURE__*/_jsx(MoveToBack,{path:\"-1\"}),data.length>0?/*#__PURE__*/_jsx(OptionBtn,{option:option,setOption:setOption,setData:setData}):null,/*#__PURE__*/_jsx(Iframe,{className:\"vr-frame\",url:\"../iframeVR/IframeVR.html\",frameBorder:0,onLoad:function onLoad(){return setTimeout(function(){setIsLoaded(true);setIsLoading(true);},1000);}})]})]});}export default VR;","map":{"version":3,"names":["Iframe","useNavigate","useLocation","useEffect","useState","Loading","MoveToBack","useRecoilState","getMessageVR","OptionBtn","loadingState","InitMessage","VR","isLoading","setIsLoading","navigate","option","setOption","data","setData","isFinished","setIsFinished","state","position","location","setLocation","isLoaded","setIsLoaded","navigator","geolocation","getCurrentPosition","pos","lat","coords","latitude","lng","longitude","alert","optionString","i","then","res","prev","concat","catch","err","console","log","length","child","document","getElementsByTagName","contentWindow","postMessage","postId","setPostId","receiveMsgFromChild","ev","window","addEventListener","removeEventListener","setTimeout"],"sources":["C:/Users/Administrator/Desktop/S07P31C209/frontend/src/screens/VR.tsx"],"sourcesContent":["import './VR.scss';\r\nimport Iframe from 'react-iframe';\r\nimport {useNavigate, useLocation} from 'react-router-dom';\r\nimport {useEffect, useState} from 'react';\r\nimport Loading from '@/components/loading/Loading';\r\nimport MoveToBack from '@/components/common/MoveToBack';\r\nimport {useRecoilState} from 'recoil';\r\n\r\nimport {getMessageVR} from '@/apis/vr';\r\nimport {LocationParams} from '@/apis';\r\nimport OptionBtn from '@/components/vr/OptionBtn';\r\nimport {loadingState} from '@apis/Recoil';\r\nimport InitMessage from '@/apis/notifications/foregroundMessaging';\r\n\r\nfunction VR() {\r\n  // recoil\r\n  const [isLoading, setIsLoading] = useRecoilState(loadingState);\r\n\r\n  const navigate = useNavigate();\r\n\r\n  // 정렬 옵션: false-최신순, true-좋아요순\r\n  const [option, setOption] = useState(false);\r\n\r\n  const [data, setData] = useState([]);\r\n  const [isFinished, setIsFinished] = useState(-1);\r\n\r\n  // 이전 페이지에서 받은 위치 정보를 location에 저장\r\n  const state = useLocation().state;\r\n  const position = state ? (state.position as LocationParams) : null;\r\n  const [location, setLocation] = useState(position);\r\n\r\n  // iframe 준비 확인\r\n  const [isLoaded, setIsLoaded] = useState(false);\r\n\r\n  useEffect(() => {\r\n    // 받은 위치 정보가 없을 경우, 현재 위치 받아오기\r\n    if (location === null) {\r\n      if (navigator.geolocation) {\r\n        navigator.geolocation.getCurrentPosition(async pos => {\r\n          setLocation({\r\n            lat: pos.coords.latitude,\r\n            lng: pos.coords.longitude,\r\n          });\r\n        });\r\n      } else {\r\n        alert('브라우저에서 위치 정보를 얻을 수 없습니다.');\r\n        navigate(-1);\r\n      }\r\n    } else {\r\n      // 서버에서 데이터 받아오기\r\n      const optionString = option ? 'like' : 'latest';\r\n\r\n      for (let i = 0; i < 4; i++) {\r\n        getMessageVR(i, optionString, location)\r\n          .then(res => {\r\n            setData(prev => prev.concat(res.data));\r\n            setIsFinished(prev => prev + 1);\r\n          })\r\n          .catch(err => {\r\n            console.log(err);\r\n          });\r\n      }\r\n    }\r\n  }, [isLoaded, option]);\r\n\r\n  // 자식에 데이터 전달\r\n  useEffect(() => {\r\n    if (isFinished === 3 && data.length > 0) {\r\n      console.log(option);\r\n      const child = document.getElementsByTagName('iframe');\r\n      child[0].contentWindow?.postMessage(data, '*');\r\n      setIsFinished(-1);\r\n    }\r\n  }, [isFinished, data]);\r\n\r\n  // 자식에게서 메세지 받을 경우 페이지 이동\r\n  const [postId, setPostId] = useState(0);\r\n\r\n  const receiveMsgFromChild = (ev: MessageEvent<any>) => {\r\n    if (ev.data === 'denied') {\r\n      navigate(-1);\r\n    } else if (ev.data === 'create') {\r\n      navigate('/message/create');\r\n    } else if (typeof ev.data === 'number') {\r\n      setPostId(ev.data);\r\n      navigate(`/message/detail/${ev.data}`);\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    window.addEventListener('message', receiveMsgFromChild);\r\n    return () => window.removeEventListener('message', receiveMsgFromChild);\r\n  }, [postId]);\r\n\r\n  return (\r\n    <>\r\n      <InitMessage />\r\n      <div className=\"vr\">\r\n        {isLoaded ? null : <Loading />}\r\n\r\n        <MoveToBack path=\"-1\" />\r\n        {data.length > 0 ? (\r\n          <OptionBtn option={option} setOption={setOption} setData={setData} />\r\n        ) : null}\r\n\r\n        <Iframe\r\n          className=\"vr-frame\"\r\n          url=\"../iframeVR/IframeVR.html\"\r\n          frameBorder={0}\r\n          onLoad={() =>\r\n            setTimeout(() => {\r\n              setIsLoaded(true);\r\n              setIsLoading(true);\r\n            }, 1000)\r\n          }\r\n        />\r\n      </div>\r\n    </>\r\n  );\r\n}\r\n\r\nexport default VR;\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}